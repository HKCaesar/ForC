


### Load libraries and data

```{r libraries}
# install.packages("dplyr")
library(dplyr)
library(tabplot) # https://cran.r-project.org/web/packages/tabplot/vignettes/tabplot-vignette.html
library(ggplot2)
# Read in data (change path to folder containing these files, or change working directory)
sites <- read.csv("TropForC_sites.csv", stringsAsFactors = FALSE) %>% tbl_df
plothistory <- read.csv("TropForC_plothistory.csv", stringsAsFactors = FALSE) %>% tbl_df
measurements <- read.csv("TropForC_measurements.csv", stringsAsFactors = FALSE) %>% tbl_df
```

### Summary of tables

```{r summaries}

summary(sites)
summary(plothistory)
summary(measurements)
```

|unit | number | 
|----|----|
| observations | `r nrow(measure)` |
| sites |  `r length(sites$sites.sitename)` |
| plots | `r length(unique(c(plothist$sites.sitename, plothist$plot.name)))` |
| areas | `r length(unique(sites$area))` |


### Joining tables

```{r merge tables}

sites.to.join <- sites[ , c("siteID", "sites.sitename", "area", "biogeog", "Koeppen", "FAOecozone")]
measure.sites <- merge(measure, sites.to.join, by="sites.sitename")
measure.hist <- merge(measure, plothist, by=c("sites.sitename", "plot.name"))
plothist.sites <- merge(plothist, sites.to.join, by="sites.sitename")

```

### Classify by age 

```{r}
measure$stand.age <- as.numeric(measure$stand.age) #convert to numeric
measure$ageclass <- "NA"
for (i in 1:length(measure$ageclass)) {
   if (is.na(measure$stand.age[i]) == FALSE)
   { 
      if (measure$stand.age[i] < 20.5)
      { measure$ageclass[i] <- "young"}
      else {
         if (measure$stand.age[i] > 99.9)
         { measure$ageclass[i] <- "mature"}
         else {
            if (measure$stand.age[i] > 20.49 & measure$stand.age[i] < 100)
            {measure$ageclass[i] <- "intermediate"} 
         }
      }
   }
}
table(measure$ageclass)
```

# Quick look at variables
table(measure$variables.name)

# Subset aboveground biomass and deadwood
th.agb <- subset(measure.sites, measure.sites$variables.name == "Biomass_ag" | measure.sites$variables.name == "C_ag")
th.dw <- subset(measure.sites, measure.sites$variables.name == "Deadwood" | measure.sites$variables.name == "C_deadwood")
```